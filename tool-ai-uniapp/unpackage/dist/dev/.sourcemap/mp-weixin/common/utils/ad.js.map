{"version":3,"file":"ad.js","sources":["common/utils/ad.js"],"sourcesContent":["/**\n * 广告工具\n */\nimport { ENABLE_AD, AD_CONFIG, AD_TIPS } from '@/common/config/ad-config.js';\n\n// 激励视频广告\nexport const showRewardedVideo = (adUnitId) => {\n    return new Promise((resolve, reject) => {\n        // 如果未开启广告，直接resolve\n        if (!ENABLE_AD) {\n            console.log('广告功能已关闭（开发模式）');\n            resolve(true);\n            return;\n        }\n\n        // #ifdef MP-WEIXIN\n        const videoAd = wx.createRewardedVideoAd({\n            adUnitId: adUnitId || AD_CONFIG.REWARDED_VIDEO_AD_UNIT_ID\n        });\n\n        let startTime = Date.now();\n        let isCompleted = false;\n\n        videoAd.onLoad(() => {\n            console.log('激励视频加载成功');\n        });\n\n        videoAd.onError((err) => {\n            console.error('激励视频加载失败', err);\n            reject(err);\n        });\n\n        videoAd.onClose((res) => {\n            const duration = Date.now() - startTime;\n            // 5秒内关闭视为无效\n            if (res && res.isEnded && duration >= 5000) {\n                isCompleted = true;\n                resolve(true);\n            } else {\n                uni.showToast({\n                    title: AD_TIPS.REWARDED_VIDEO_NOT_COMPLETED,\n                    icon: 'none'\n                });\n                reject(new Error('广告未完整观看'));\n            }\n        });\n\n        videoAd.load()\n            .then(() => videoAd.show())\n            .catch(err => {\n                console.error('激励视频播放失败', err);\n                reject(err);\n            });\n        // #endif\n\n        // #ifndef MP-WEIXIN\n        // 非微信小程序环境，直接resolve\n        resolve(true);\n        // #endif\n    });\n};\n\n// 插屏广告\nexport const showInterstitialAd = (adUnitId, shouldShow) => {\n    // 如果未开启广告，直接resolve\n    if (!ENABLE_AD) {\n        console.log('广告功能已关闭（开发模式）');\n        return Promise.resolve();\n    }\n\n    if (!shouldShow) {\n        return Promise.resolve();\n    }\n\n    return new Promise((resolve) => {\n        // #ifdef MP-WEIXIN\n        const interstitialAd = wx.createInterstitialAd({\n            adUnitId: adUnitId || AD_CONFIG.INTERSTITIAL_AD_UNIT_ID\n        });\n\n        interstitialAd.onLoad(() => {\n            console.log('插屏广告加载成功');\n        });\n\n        interstitialAd.onError((err) => {\n            console.error('插屏广告加载失败', err);\n            resolve(); // 失败也resolve，不影响主流程\n        });\n\n        interstitialAd.onClose(() => {\n            resolve();\n        });\n\n        interstitialAd.load()\n            .then(() => interstitialAd.show())\n            .catch(err => {\n                console.error('插屏广告播放失败', err);\n                resolve();\n            });\n        // #endif\n\n        // #ifndef MP-WEIXIN\n        resolve();\n        // #endif\n    });\n};\n\n// Banner广告组件ID（已迁移到 ad-config.js）\nexport const BANNER_AD_UNIT_ID = AD_CONFIG.BANNER_AD_UNIT_ID;\n\n"],"names":["uni"],"mappings":";;AAMY,MAAC,oBAAoB,CAAC,aAAa;AAC3C,SAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AAEpB;AACZA,oBAAAA,MAAA,MAAA,OAAA,4BAAY,eAAe;AAC3B,cAAQ,IAAI;AACZ;AAAA,IACH;AAAA,EA8CT,CAAK;AACL;AAGY,MAAC,qBAAqB,CAAC,UAAU,eAAe;AAExC;AACZA,kBAAAA,MAAA,MAAA,OAAA,4BAAY,eAAe;AAC3B,WAAO,QAAQ;EAClB;AAqCL;;;"}