{"version":3,"file":"request.js","sources":["common/utils/request.js"],"sourcesContent":["/**\n * 请求工具\n */\nimport apiConfig from '@/common/config/api-config.js';\n\nconst baseUrl = apiConfig.BASE_URL;\n\nconst request = (options) => {\n    return new Promise((resolve, reject) => {\n        const token = uni.getStorageSync('token');\n        \n        uni.request({\n            url: baseUrl + options.url,\n            method: options.method || 'GET',\n            data: options.data || {},\n            header: {\n                'Content-Type': 'application/json',\n                'Authorization': token ? `Bearer ${token}` : ''\n            },\n            success: (res) => {\n                if (res.statusCode === 200) {\n                    if (res.data.code === 200) {\n                        resolve(res.data);\n                    } else if (res.data.code === 401 || res.data.code === 40101 || res.data.code === 40102) {\n                        // Token失效，重新登录\n                        uni.removeStorageSync('token');\n                        uni.removeStorageSync('openid');\n                        uni.reLaunch({\n                            url: '/pages/index/index'\n                        });\n                        reject(res.data);\n                    } else {\n                        // 对于429等错误，显示更明确的提示\n                        const errorMessage = res.data.message || '请求失败';\n                        uni.showToast({\n                            title: errorMessage,\n                            icon: 'none',\n                            duration: 3000  // 显示3秒，确保用户能看到\n                        });\n                        reject(res.data);\n                    }\n                } else {\n                    uni.showToast({\n                        title: '网络错误',\n                        icon: 'none'\n                    });\n                    reject(res);\n                }\n            },\n            fail: (err) => {\n                uni.showToast({\n                    title: '网络错误',\n                    icon: 'none'\n                });\n                reject(err);\n            }\n        });\n    });\n};\n\nexport default request;\n\n\n"],"names":["apiConfig","uni"],"mappings":";;;AAKA,MAAM,UAAUA,wBAAS,UAAC;AAErB,MAAC,UAAU,CAAC,YAAY;AACzB,SAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AACpC,UAAM,QAAQC,cAAAA,MAAI,eAAe,OAAO;AAExCA,kBAAAA,MAAI,QAAQ;AAAA,MACR,KAAK,UAAU,QAAQ;AAAA,MACvB,QAAQ,QAAQ,UAAU;AAAA,MAC1B,MAAM,QAAQ,QAAQ,CAAE;AAAA,MACxB,QAAQ;AAAA,QACJ,gBAAgB;AAAA,QAChB,iBAAiB,QAAQ,UAAU,KAAK,KAAK;AAAA,MAChD;AAAA,MACD,SAAS,CAAC,QAAQ;AACd,YAAI,IAAI,eAAe,KAAK;AACxB,cAAI,IAAI,KAAK,SAAS,KAAK;AACvB,oBAAQ,IAAI,IAAI;AAAA,UACnB,WAAU,IAAI,KAAK,SAAS,OAAO,IAAI,KAAK,SAAS,SAAS,IAAI,KAAK,SAAS,OAAO;AAEpFA,gCAAI,kBAAkB,OAAO;AAC7BA,gCAAI,kBAAkB,QAAQ;AAC9BA,0BAAAA,MAAI,SAAS;AAAA,cACT,KAAK;AAAA,YACjC,CAAyB;AACD,mBAAO,IAAI,IAAI;AAAA,UACvC,OAA2B;AAEH,kBAAM,eAAe,IAAI,KAAK,WAAW;AACzCA,0BAAAA,MAAI,UAAU;AAAA,cACV,OAAO;AAAA,cACP,MAAM;AAAA,cACN,UAAU;AAAA;AAAA,YACtC,CAAyB;AACD,mBAAO,IAAI,IAAI;AAAA,UAClB;AAAA,QACrB,OAAuB;AACHA,wBAAAA,MAAI,UAAU;AAAA,YACV,OAAO;AAAA,YACP,MAAM;AAAA,UAC9B,CAAqB;AACD,iBAAO,GAAG;AAAA,QACb;AAAA,MACJ;AAAA,MACD,MAAM,CAAC,QAAQ;AACXA,sBAAAA,MAAI,UAAU;AAAA,UACV,OAAO;AAAA,UACP,MAAM;AAAA,QAC1B,CAAiB;AACD,eAAO,GAAG;AAAA,MACb;AAAA,IACb,CAAS;AAAA,EACT,CAAK;AACL;;"}