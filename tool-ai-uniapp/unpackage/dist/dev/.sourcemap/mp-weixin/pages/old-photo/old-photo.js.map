{"version":3,"file":"old-photo.js","sources":["pages/old-photo/old-photo.vue","pages/old-photo/old-photo.vue?type=page"],"sourcesContent":["<template>\n    <view class=\"container\">\n        <view class=\"upload-card\" @click=\"chooseImage\">\n            <image v-if=\"imageUrl\" :src=\"imageUrl\" class=\"preview-image\" mode=\"aspectFit\"></image>\n            <view v-else class=\"upload-placeholder\">\n                <text class=\"upload-icon\">üì∏</text>\n                <text class=\"upload-text\">ÁÇπÂáª‰∏ä‰º†ËÄÅÁÖßÁâá</text>\n                <text class=\"upload-subtext\">ÊîØÊåÅJPG/PNGÔºåÂª∫ËÆÆ‰∫∫ËÑ∏Ê∏ÖÊô∞Êó†ÈÅÆÊå°</text>\n            </view>\n        </view>\n\n        <view class=\"form-card\">\n            <view class=\"form-row\">\n                <text class=\"label\">‰øÆÂ§çÂº∫Â∫¶</text>\n                <text class=\"value-text\">{{ (strength * 100).toFixed(0) }}%</text>\n            </view>\n            <slider\n                :value=\"strength * 100\"\n                min=\"50\"\n                max=\"100\"\n                step=\"5\"\n                activeColor=\"#667eea\"\n                backgroundColor=\"#e0e0e0\"\n                block-size=\"18\"\n                @change=\"onStrengthChange\"\n            />\n            <view class=\"tips\">\n                <text class=\"tips-text\">ÈªòËÆ§70%ÔºåÊõ¥È´ò‰ºöÊõ¥ÈîêÂà©‰ΩÜÂèØËÉΩÂ∏¶Êù•ËΩªÂæÆÂ§±Áúü</text>\n            </view>\n        </view>\n\n        <button\n            class=\"generate-btn\"\n            :disabled=\"!imageUrl || generating\"\n            @click=\"restore\"\n        >\n            {{ generating ? '‰øÆÂ§ç‰∏≠...' : 'ÂºÄÂßã‰øÆÂ§ç' }}\n        </button>\n\n        <!-- BannerÂπøÂëä -->\n        <ad-video-banner />\n    </view>\n</template>\n\n<script>\nimport api from '@/common/utils/api.js';\nimport apiConfig from '@/common/config/api-config.js';\nimport AdVideoBanner from '@/common/components/ad-video-banner.vue';\n\nexport default {\n    components: {\n        AdVideoBanner\n    },\n    data() {\n        return {\n            imageUrl: '', // OSS Âú∞ÂùÄ\n            imageTempPath: '', // Êú¨Âú∞È¢ÑËßà\n            strength: 0.7,\n            generating: false\n        };\n    },\n    methods: {\n        onStrengthChange(e) {\n            this.strength = (e.detail.value || 70) / 100;\n        },\n        chooseImage() {\n            uni.chooseImage({\n                count: 1,\n                sizeType: ['original', 'compressed'],\n                sourceType: ['album', 'camera'],\n                success: (res) => {\n                    this.imageTempPath = res.tempFilePaths[0];\n                    this.imageUrl = this.imageTempPath; // ÂÖàÊú¨Âú∞È¢ÑËßà\n                    this.uploadImage();\n                },\n                fail: (err) => {\n                    console.error('ÈÄâÊã©ÂõæÁâáÂ§±Ë¥•', err);\n                    uni.showToast({\n                        title: 'ÈÄâÊã©ÂõæÁâáÂ§±Ë¥•',\n                        icon: 'none'\n                    });\n                }\n            });\n        },\n        async uploadImage() {\n            if (!this.imageTempPath) return;\n            uni.showLoading({ title: '‰∏ä‰º†‰∏≠...' });\n            try {\n                const token = uni.getStorageSync('token');\n                if (!token) throw new Error('Êú™ÁôªÂΩï');\n\n                const uploadRes = await new Promise((resolve, reject) => {\n                    uni.uploadFile({\n                        url: `${apiConfig.BASE_URL}/tool/upload-image`,\n                        filePath: this.imageTempPath,\n                        name: 'file',\n                        header: { 'Authorization': 'Bearer ' + token },\n                        success: (res) => {\n                            try {\n                                const data = JSON.parse(res.data);\n                                if (data.code === 200) {\n                                    resolve(data);\n                                } else {\n                                    reject(new Error(data.message || '‰∏ä‰º†Â§±Ë¥•'));\n                                }\n                            } catch (e) {\n                                reject(new Error('Ëß£ÊûêÂìçÂ∫îÂ§±Ë¥•'));\n                            }\n                        },\n                        fail: reject\n                    });\n                });\n\n                if (uploadRes.data && uploadRes.data.imageUrl) {\n                    this.imageUrl = uploadRes.data.imageUrl;\n                }\n                uni.hideLoading();\n            } catch (e) {\n                console.error('‰∏ä‰º†ÂõæÁâáÂ§±Ë¥•', e);\n                uni.hideLoading();\n                uni.showToast({\n                    title: e.message || '‰∏ä‰º†Â§±Ë¥•',\n                    icon: 'none'\n                });\n                this.imageUrl = '';\n                this.imageTempPath = '';\n            }\n        },\n        async restore() {\n            if (!this.imageUrl) {\n                uni.showToast({ title: 'ËØ∑ÂÖà‰∏ä‰º†ÁÖßÁâá', icon: 'none' });\n                return;\n            }\n            this.generating = true;\n            try {\n                const res = await api.restoreOldPhoto({\n                    imageUrl: this.imageUrl,\n                    strength: Number(this.strength.toFixed(2))\n                });\n                if (res.code === 200) {\n                    uni.navigateTo({\n                        url: `/pages/result/result?type=6&resultUrl=${encodeURIComponent(res.data.resultUrl)}`\n                    });\n                } else {\n                    uni.showToast({\n                        title: res.message || '‰øÆÂ§çÂ§±Ë¥•',\n                        icon: 'none'\n                    });\n                }\n            } catch (e) {\n                console.error('‰øÆÂ§çÂ§±Ë¥•', e);\n                uni.showToast({\n                    title: e.message || '‰øÆÂ§çÂ§±Ë¥•ÔºåËØ∑ÈáçËØï',\n                    icon: 'none'\n                });\n            } finally {\n                this.generating = false;\n            }\n        }\n    }\n};\n</script>\n\n<style scoped>\n.container {\n    min-height: 100vh;\n    background: #f5f5f5;\n    padding: 30rpx;\n}\n\n.upload-card {\n    background: #fff;\n    border-radius: 20rpx;\n    padding: 40rpx 30rpx;\n    margin-bottom: 30rpx;\n    border: 2rpx dashed #ddd;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    min-height: 360rpx;\n}\n\n.upload-placeholder {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 12rpx;\n    color: #777;\n}\n\n.upload-icon {\n    font-size: 80rpx;\n}\n\n.upload-text {\n    font-size: 32rpx;\n    color: #333;\n    font-weight: 500;\n}\n\n.upload-subtext {\n    font-size: 24rpx;\n    color: #999;\n}\n\n.preview-image {\n    width: 100%;\n    max-height: 500rpx;\n    border-radius: 12rpx;\n}\n\n.form-card {\n    background: #fff;\n    border-radius: 20rpx;\n    padding: 30rpx;\n    margin-bottom: 30rpx;\n}\n\n.form-row {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 20rpx;\n}\n\n.label {\n    font-size: 28rpx;\n    color: #333;\n    font-weight: 500;\n}\n\n.value-text {\n    font-size: 28rpx;\n    color: #667eea;\n}\n\n.tips {\n    margin-top: 10rpx;\n}\n\n.tips-text {\n    font-size: 24rpx;\n    color: #999;\n}\n\n.generate-btn {\n    width: 100%;\n    height: 88rpx;\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n    color: #fff;\n    border-radius: 44rpx;\n    font-size: 32rpx;\n    border: none;\n    margin-top: 20rpx;\n}\n\n.generate-btn[disabled] {\n    background: #ccc;\n}\n</style>\n\n","import MiniProgramPage from '/Users/gongxuesong/Work/individual/Â∑•ÂÖ∑/tool-ai-all/tool-ai-uniapp/pages/old-photo/old-photo.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","apiConfig","api"],"mappings":"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"}