# 小程序图片域名配置说明

## 问题描述

小程序中图片无法显示，但图片URL在浏览器中可以正常访问。这是因为微信小程序对图片域名有白名单限制。

## 解决方案

### 方案1：配置图片域名白名单（推荐）

1. **登录微信小程序后台**
   - 访问：https://mp.weixin.qq.com
   - 使用小程序管理员账号登录

2. **进入开发管理**
   - 左侧菜单：开发 → 开发管理 → 开发设置

3. **配置服务器域名**
   - 找到"服务器域名"配置项
   - 点击"修改"按钮

4. **添加图片域名**
   - 在"downloadFile合法域名"中添加图片服务器域名
   - 例如：如果图片URL是 `https://xxx.volcengine.com/xxx.jpg`
   - 则添加域名：`https://xxx.volcengine.com`
   - 注意：只需要添加域名部分，不需要协议和路径

5. **保存配置**
   - 点击"保存"按钮
   - 配置可能需要几分钟生效

### 方案2：使用后端代理（如果无法配置域名）

如果无法在微信小程序后台配置域名（例如使用测试号），可以让后端代理图片：

1. **后端添加图片代理接口**
   ```java
   @GetMapping("/proxy/image")
   public void proxyImage(@RequestParam String url, HttpServletResponse response) {
       // 下载图片并转发给小程序
   }
   ```

2. **前端使用代理URL**
   ```javascript
   const proxyUrl = `${apiBaseUrl}/proxy/image?url=${encodeURIComponent(imageUrl)}`;
   ```

### 方案3：上传到OSS（推荐用于生产环境）

将图片上传到自己的OSS（如阿里云OSS、腾讯云COS），然后配置OSS域名到小程序白名单。

## 当前图片域名

根据代码，星座运势图片来自火山引擎，域名可能是：
- `*.volcengine.com`
- `*.byteimg.com`
- `*.bytedance.com`

具体域名需要查看实际返回的图片URL。

## 检查方法

1. **查看控制台日志**
   - 在result.vue页面，我已经添加了`onImageError`错误处理
   - 图片加载失败时会弹出提示，显示图片地址

2. **查看网络请求**
   - 在微信开发者工具中，打开"Network"面板
   - 查看图片请求是否被拦截

3. **查看实际图片URL**
   - 在result.vue的`onLoad`方法中，我已经添加了console.log
   - 可以在控制台查看实际的图片URL

## 临时解决方案

如果暂时无法配置域名，可以：
1. 使用微信开发者工具的"不校验合法域名"选项（仅开发环境）
2. 使用后端代理图片接口

## 注意事项

1. **域名配置需要审核**
   - 新添加的域名可能需要微信审核
   - 审核时间通常为几分钟到几小时

2. **域名必须支持HTTPS**
   - 小程序要求所有网络请求必须使用HTTPS
   - 图片URL也必须是HTTPS

3. **测试环境限制**
   - 测试号可能无法配置域名白名单
   - 需要使用正式小程序账号

4. **图片格式限制**
   - 小程序支持的图片格式：jpg、jpeg、png、gif、webp、svg
   - 其他格式可能无法显示

## 相关文件

- `tool-ai-uniapp/pages/result/result.vue` - 结果页面，包含图片显示和错误处理
- `tool-ai-uniapp/manifest.json` - 小程序配置文件


